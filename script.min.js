document.addEventListener("DOMContentLoaded", () => {
    function t(t, e) {
        const o = document.createElement("div");
        o.className = "floating-heart", document.getElementById("floating-hearts-container").appendChild(o);
        lottie.loadAnimation({
            container: o,
            renderer: "svg",
            loop: !1,
            autoplay: !0,
            path: "https://fonts.gstatic.com/s/e/notoemoji/latest/1fa77/lottie.json"
        });
        const n = Math.random() * Math.PI + Math.PI,
            a = 200 + 300 * Math.random(),
            i = 1.5 + 1.5 * Math.random();
        gsap.fromTo(o, {
            x: t,
            y: e,
            scale: .8
        }, {
            x: t + Math.cos(n) * a,
            y: e + Math.sin(n) * a,
            scale: 1.2 + .3 * Math.random(),
            duration: i,
            ease: "power2.out",
            onComplete: () => o.remove()
        })
    }

    function e(e, o) {
        for (let n = 0; n < 20; n++) setTimeout(() => {
            t(e + 20 * (Math.random() - .5), o + 20 * (Math.random() - .5))
        }, 80 * n)
    }
    const o = document.querySelector(".envelope-wrapper"),
        n = (lottie.loadAnimation({
            container: document.getElementById("heart-lottie"),
            renderer: "svg",
            loop: !0,
            autoplay: !0,
            path: "https://fonts.gstatic.com/s/e/notoemoji/latest/2764_fe0f/lottie.json"
        }), () => {
            const t = !o.classList.contains("flap"),
                n = window.innerWidth >= 768;
            if (t) {
                o.classList.add("flap");
                const t = gsap.timeline();
                t.to(o, {
                    y: n ? 120 : 80,
                    duration: .5,
                    ease: "power2.inOut"
                }).to(".letter", {
                    yPercent: -60,
                    height: "110%",
                    duration: .7,
                    ease: "power2.out",
                    onComplete: () => {
                        const t = document.querySelector(".envelope-wrapper"),
                            o = t.getBoundingClientRect(),
                            n = o.left + o.width / 2 - 40,
                            a = o.top + o.height / 2 - 40;
                        e(n, a)
                    }
                }, "-=0.3")
            } else {
                const t = gsap.timeline();
                t.to(".letter", {
                    yPercent: 0,
                    height: "70%",
                    duration: .5,
                    ease: "power2.inOut"
                }).to(o, {
                    y: 0,
                    duration: .4,
                    ease: "power2.inOut",
                    onComplete: () => {
                        o.classList.remove("flap")
                    }
                }, "-=0.3")
            }
        });
    o.addEventListener("click", n), document.getElementById("heart-lottie").addEventListener("click", t => {
        t.stopPropagation(), n()
    });
    const a = document.getElementById("next-btn"),
        i = document.getElementById("memory-overlay"),
        s = document.getElementById("no-btn"),
        r = document.getElementById("yes-btn");
    let d = 0;
    a.addEventListener("click", t => {
        t.stopPropagation(), gsap.set("#memory-overlay", {
            opacity: 0,
            display: "flex"
        }), gsap.set(".memory-content", {
            opacity: 0,
            y: 40
        }), gsap.set("#question-text, #button-group", {
            opacity: 0,
            y: 20
        });
        const e = gsap.timeline();
        e.to(".envelope-wrapper", {
            x: -window.innerWidth,
            duration: .8,
            ease: "power2.inOut"
        }).to("#memory-overlay", {
            opacity: 1,
            duration: 2,
            ease: "power1.inOut"
        }, "-=0.5").to(".memory-content", {
            opacity: 1,
            y: 0,
            duration: .8,
            ease: "power2.out"
        }, "-=0.8").to("#question-text", {
            opacity: 1,
            y: 0,
            duration: .6,
            ease: "back.out(1.7)"
        }, "+=0.1").to("#button-group", {
            opacity: 1,
            y: 0,
            duration: .6,
            ease: "back.out(1.7)"
        }, "-=0.4"), i.classList.add("active")
    }), s.addEventListener("click", () => {
        d++;
        const t = 1 + .2 * d,
            e = Math.min(60, 20 + 8 * d),
            o = Math.max(50 - 8 * d, 25),
            n = (r.getBoundingClientRect(), s.getBoundingClientRect());
        if (d < 7) {
            const t = 50 + 30 * d,
                e = Math.random() * Math.PI * 2,
                o = n.left,
                a = n.top;
            let i = o + Math.cos(e) * t,
                r = a + Math.sin(e) * t;
            const l = 20;
            i = Math.max(l, Math.min(i, window.innerWidth - n.width - l)), r = Math.max(l, Math.min(r, window.innerHeight - n.height - l)), gsap.to(s, {
                x: i - o,
                y: r - a,
                duration: .3,
                ease: "power2.out"
            })
        } else gsap.to(s, {
            x: window.innerWidth,
            duration: .5,
            ease: "power2.inOut",
            onComplete: () => {
                s.style.display = "none", gsap.to("#yes-btn", {
                    width: "100vw",
                    height: "100vh",
                    duration: 1,
                    ease: "power2.inOut"
                })
            }
        });
        gsap.to("#yes-btn", {
            scale: t,
            width: `${e}vmin`,
            height: `${e}vmin`,
            borderRadius: `${o}%`,
            duration: .5,
            ease: "elastic.out(1, 0.3)",
            fontSize: `${Math.min(2+.3*d,4)}rem`,
            boxShadow: `0 ${4+2*d}px ${15+5*d}px rgba(255, 107, 139, ${.3+.1*d})`
        }), d >= 7 && gsap.to("#yes-btn", {
            width: "100vw",
            height: "100vh",
            borderRadius: "0%",
            duration: 1,
            ease: "power2.inOut",
            boxShadow: "none"
        })
    }), r.addEventListener("click", () => {
        gsap.to("#memory-overlay", {
            opacity: 0,
            duration: 1,
            onComplete: () => {
                window.location.href = "memories.html"
            }
        })
    })
});